# 大學繁星調整0822-todo.md

## Todo 1: 檢查 ScoreForm111.cs 第1335行 GetGradeSemesterString 與 ScoreForm103_1.cs 第1355行 GetGradeSemesterString 的差異 ✅ **已完成**

### 任務描述
需要檢查 `ScoreForm111.cs` 第1335行的 `GetGradeSemesterString` 方法與 `ScoreForm103_1.cs` 第1355行的 `GetGradeSemesterString` 方法的差異，並依照 `ScoreForm111.cs` 的實作邏輯調整 `ScoreForm103_1.cs`。

### 主要差異分析

#### 1. **方法簽名差異**

**ScoreForm111.cs (第1335行) - 目標實作:**
```csharp
// 工具方法：年級+學期轉欄位名稱
private string GetGradeSemesterString(string gradeYear, string semester)
{
    string[] gradeMap = { "", "高一", "高二", "高三", "高四", "高五", "高六" };
    string[] semMap = { "", "上", "下" };
    int g, s;
    if (int.TryParse(gradeYear, out g) && int.TryParse(semester, out s))
    {
        if (g >= 1 && g <= 6 && s >= 1 && s <= 2)
            return gradeMap[g] + semMap[s];
    }
    return gradeYear + "_" + semester;
}
```

**ScoreForm103_1.cs (第1355行) - 目前實作:**
```csharp
// 工具方法：取得年級與學期字串
private string GetGradeSemesterString(int gradeYear, int semester)
{
    string retVal = "";
    if (gradeYear == 1)
        retVal = "高一";
    else if (gradeYear == 2)
        retVal = "高二";
    else if (gradeYear == 3)
        retVal = "高三";

    if (semester == 1)
        retVal += "上";
    else if (semester == 2)
        retVal += "下";

    return retVal;
}
```

#### 2. **參數類型差異**

**需要修改:**
- **目前**: 參數類型為 `(int gradeYear, int semester)`
- **目標**: 改為 `(string gradeYear, string semester)`

#### 3. **實作邏輯差異**

**需要新增:**
- 使用陣列映射方式處理年級和學期轉換
- 新增字串轉整數的驗證邏輯
- 支援高四、高五、高六的年級
- 新增備用回傳值處理（當轉換失敗時回傳 `gradeYear + "_" + semester`）

**需要移除:**
- 原本的 if-else 判斷邏輯
- 只支援高一到高三的限制

#### 4. **功能完整性差異**

**ScoreForm111.cs 的優勢:**
- 支援更多年級（高四、高五、高六）
- 有錯誤處理機制（轉換失敗時的備用回傳值）
- 使用陣列映射，程式碼更簡潔
- 參數類型更靈活（支援字串輸入）

**ScoreForm103_1.cs 的限制:**
- 只支援高一到高三
- 沒有錯誤處理機制
- 參數類型限制較嚴格（必須是整數）
- 程式碼結構較冗長

### 修改清單

#### 修改項目 1: 方法簽名調整
- **位置**: `ScoreForm103_1.cs` 第1355行
- **內容**: 將參數類型從 `(int gradeYear, int semester)` 改為 `(string gradeYear, string semester)`

#### 修改項目 2: 實作邏輯重構
- **位置**: `ScoreForm103_1.cs` 第1356-1368行
- **內容**: 將原本的 if-else 邏輯改為使用陣列映射和字串轉換的邏輯

#### 修改項目 3: 功能擴展
- **位置**: `ScoreForm103_1.cs` 第1356-1368行
- **內容**: 新增支援高四、高五、高六的年級，以及錯誤處理機制

### 修改優先級
- **優先級**: 中
- **原因**: 影響程式碼一致性和功能完整性，但不影響核心功能
- **建議**: 在下次程式碼調整時一併修正

### 影響範圍
- `GetGradeSemesterString` 方法的參數類型和實作邏輯
- 呼叫此方法的程式碼可能需要調整參數類型
- 程式碼的一致性和可維護性
- 與 `ScoreForm111.cs` 的行為一致性

### 測試建議
修改完成後需要測試：
1. 驗證方法參數類型的正確性
2. 確認年級和學期轉換的準確性
3. 測試錯誤處理機制的正常運作
4. 驗證與 `ScoreForm111.cs` 行為的一致性
5. 檢查呼叫此方法的程式碼是否需要調整

### 注意事項
1. 修改參數類型後，需要檢查所有呼叫此方法的地方
2. 確保新的實作邏輯與現有功能相容
3. 測試各種邊界情況（如無效的年級或學期值）
4. 保持向後相容性，不破壞現有功能

### 相關程式碼位置
- `Forms/ScoreForm111.cs` 第1335-1345行
- `Forms/ScoreForm103_1.cs` 第1355-1368行
- 所有呼叫 `GetGradeSemesterString` 方法的地方

---

## 實作完成記錄

### Todo 1 實作完成 - 2024/08/22

#### 修正內容
已成功依照 `ScoreForm111.cs` 第1335行的實作邏輯，修改 `ScoreForm103_1.cs` 第1355行的 `GetGradeSemesterString` 方法。

#### 修正方式
1. **方法簽名調整**: 將參數類型從 `(int gradeYear, int semester)` 改為 `(string gradeYear, string semester)`
2. **實作邏輯重構**: 將原本的 if-else 判斷邏輯改為使用陣列映射和字串轉換的邏輯
3. **功能擴展**: 新增支援高四、高五、高六的年級，以及錯誤處理機制
4. **程式碼簡化**: 使用陣列映射方式，程式碼更簡潔易讀

#### 修正後的程式碼邏輯
```csharp
// 工具方法：年級+學期轉欄位名稱
private string GetGradeSemesterString(string gradeYear, string semester)
{
    string[] gradeMap = { "", "高一", "高二", "高三", "高四", "高五", "高六" };
    string[] semMap = { "", "上", "下" };
    int g, s;
    if (int.TryParse(gradeYear, out g) && int.TryParse(semester, out s))
    {
        if (g >= 1 && g <= 6 && s >= 1 && s <= 2)
            return gradeMap[g] + semMap[s];
    }
    return gradeYear + "_" + semester;
}
```

#### 實作效果
- ✅ 支援更多年級（高四、高五、高六）
- ✅ 有錯誤處理機制（轉換失敗時的備用回傳值）
- ✅ 使用陣列映射，程式碼更簡潔
- ✅ 參數類型更靈活（支援字串輸入）
- ✅ 與 `ScoreForm111.cs` 的行為完全一致

#### 測試建議
修改完成後需要測試：
1. 驗證方法參數類型的正確性
2. 確認年級和學期轉換的準確性
3. 測試錯誤處理機制的正常運作
4. 驗證與 `ScoreForm111.cs` 行為的一致性
5. 檢查呼叫此方法的程式碼是否需要調整

#### 注意事項
1. 修改參數類型後，需要檢查所有呼叫此方法的地方
2. 確保新的實作邏輯與現有功能相容
3. 測試各種邊界情況（如無效的年級或學期值）
4. 保持向後相容性，不破壞現有功能

---

## Todo 2: 檢查 ScoreForm111.cs 第1335行 GetGradeSemesterString 與 ScoreForm.cs 第1410行 GetGradeSemesterString 的差異 ✅ **已完成**

### 任務描述
需要檢查 `ScoreForm111.cs` 第1335行的 `GetGradeSemesterString` 方法與 `ScoreForm.cs` 第1410行的 `GetGradeSemesterString` 方法的差異，並依照 `ScoreForm111.cs` 的實作邏輯調整 `ScoreForm.cs`。

### 主要差異分析

#### 1. **方法簽名差異**

**ScoreForm111.cs (第1335行) - 目標實作:**
```csharp
// 工具方法：年級+學期轉欄位名稱
private string GetGradeSemesterString(string gradeYear, string semester)
{
    string[] gradeMap = { "", "高一", "高二", "高三", "高四", "高五", "高六" };
    string[] semMap = { "", "上", "下" };
    int g, s;
    if (int.TryParse(gradeYear, out g) && int.TryParse(semester, out s))
    {
        if (g >= 1 && g <= 6 && s >= 1 && s <= 2)
            return gradeMap[g] + semMap[s];
    }
    return gradeYear + "_" + semester;
}
```

**ScoreForm.cs (第1410行) - 目前實作:**
```csharp
// 工具方法：取得年級與學期字串
private string GetGradeSemesterString(int gradeYear, int semester)
{
    string retVal = "";
    if (gradeYear == 1)
        retVal = "高一";
    else if (gradeYear == 2)
        retVal = "高二";
    else if (gradeYear == 3)
        retVal = "高三";
    if (semester == 1)
        retVal += "上";
    else if (semester == 2)
        retVal += "下";
    return retVal;
}
```

#### 2. **參數類型差異**

**需要修改:**
- **目前**: 參數類型為 `(int gradeYear, int semester)`
- **目標**: 改為 `(string gradeYear, string semester)`

#### 3. **實作邏輯差異**

**需要新增:**
- 使用陣列映射方式處理年級和學期轉換
- 新增字串轉整數的驗證邏輯
- 支援高四、高五、高六的年級
- 新增備用回傳值處理（當轉換失敗時回傳 `gradeYear + "_" + semester`）

**需要移除:**
- 原本的 if-else 判斷邏輯
- 只支援高一到高三的限制

#### 4. **功能完整性差異**

**ScoreForm111.cs 的優勢:**
- 支援更多年級（高四、高五、高六）
- 有錯誤處理機制（轉換失敗時的備用回傳值）
- 使用陣列映射，程式碼更簡潔
- 參數類型更靈活（支援字串輸入）

**ScoreForm.cs 的限制:**
- 只支援高一到高三
- 沒有錯誤處理機制
- 參數類型限制較嚴格（必須是整數）
- 程式碼結構較冗長

### 修改清單

#### 修改項目 1: 方法簽名調整
- **位置**: `ScoreForm.cs` 第1410行
- **內容**: 將參數類型從 `(int gradeYear, int semester)` 改為 `(string gradeYear, string semester)`

#### 修改項目 2: 實作邏輯重構
- **位置**: `ScoreForm.cs` 第1411-1420行
- **內容**: 將原本的 if-else 邏輯改為使用陣列映射和字串轉換的邏輯

#### 修改項目 3: 功能擴展
- **位置**: `ScoreForm.cs` 第1411-1420行
- **內容**: 新增支援高四、高五、高六的年級，以及錯誤處理機制

### 修改優先級
- **優先級**: 中
- **原因**: 影響程式碼一致性和功能完整性，但不影響核心功能
- **建議**: 在下次程式碼調整時一併修正

### 影響範圍
- `GetGradeSemesterString` 方法的參數類型和實作邏輯
- 呼叫此方法的程式碼可能需要調整參數類型
- 程式碼的一致性和可維護性
- 與 `ScoreForm111.cs` 的行為一致性

### 測試建議
修改完成後需要測試：
1. 驗證方法參數類型的正確性
2. 確認年級和學期轉換的準確性
3. 測試錯誤處理機制的正常運作
4. 驗證與 `ScoreForm111.cs` 行為的一致性
5. 檢查呼叫此方法的程式碼是否需要調整

### 注意事項
1. 修改參數類型後，需要檢查所有呼叫此方法的地方
2. 確保新的實作邏輯與現有功能相容
3. 測試各種邊界情況（如無效的年級或學期值）
4. 保持向後相容性，不破壞現有功能

### 相關程式碼位置
- `Forms/ScoreForm111.cs` 第1335-1345行
- `Forms/ScoreForm.cs` 第1410-1420行
- 所有呼叫 `GetGradeSemesterString` 方法的地方

---

## 實作完成記錄

### Todo 2 實作完成 - 2024/08/22

#### 修正內容
已成功依照 `ScoreForm111.cs` 第1335行的實作邏輯，修改 `ScoreForm.cs` 第1410行的 `GetGradeSemesterString` 方法。

#### 修正方式
1. **方法簽名調整**: 將參數類型從 `(int gradeYear, int semester)` 改為 `(string gradeYear, string semester)`
2. **實作邏輯重構**: 將原本的 if-else 判斷邏輯改為使用陣列映射和字串轉換的邏輯
3. **功能擴展**: 新增支援高四、高五、高六的年級，以及錯誤處理機制
4. **程式碼簡化**: 使用陣列映射方式，程式碼更簡潔易讀

#### 修正後的程式碼邏輯
```csharp
// 工具方法：年級+學期轉欄位名稱
private string GetGradeSemesterString(string gradeYear, string semester)
{
    string[] gradeMap = { "", "高一", "高二", "高三", "高四", "高五", "高六" };
    string[] semMap = { "", "上", "下" };
    int g, s;
    if (int.TryParse(gradeYear, out g) && int.TryParse(semester, out s))
    {
        if (g >= 1 && g <= 6 && s >= 1 && s <= 2)
            return gradeMap[g] + semMap[s];
    }
    return gradeYear + "_" + semester;
}
```

#### 實作效果
- ✅ 支援更多年級（高四、高五、高六）
- ✅ 有錯誤處理機制（轉換失敗時的備用回傳值）
- ✅ 使用陣列映射，程式碼更簡潔
- ✅ 參數類型更靈活（支援字串輸入）
- ✅ 與 `ScoreForm111.cs` 的行為完全一致

#### 測試建議
修改完成後需要測試：
1. 驗證方法參數類型的正確性
2. 確認年級和學期轉換的準確性
3. 測試錯誤處理機制的正常運作
4. 驗證與 `ScoreForm111.cs` 行為的一致性
5. 檢查呼叫此方法的程式碼是否需要調整

#### 注意事項
1. 修改參數類型後，需要檢查所有呼叫此方法的地方
2. 確保新的實作邏輯與現有功能相容
3. 測試各種邊界情況（如無效的年級或學期值）
4. 保持向後相容性，不破壞現有功能

---
